chart4 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Cases, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#33CCFF", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#33CCFF"),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart5 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Deaths, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#FF9900", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#FF9900"),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart6 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Recovered, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#00DDDD", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#00DDDD"),tooltip = c("x", "y"))%>%
highlight(off = "plotly_relayout")
weekly_hk <- highlight_key(summary_AllDF, ~week)
ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "from")) %>%
highlight(off = "plotly_relayout")
ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
weekly_hk <- highlight_key(summary_AllDF, ~week)
chart1 <-ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
chart2 <-ggplotly(ggplot(weekly_hk, aes(x=Day, y=New.Deaths, fill=Curfew)) + scale_x_discrete(breaks = xlabel)+
geom_bar(width = 0.3, stat = "identity")+scale_fill_manual(values = c("#6698FF", "#153E7E"))+
theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1)),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to) , text2 =paste("number of days:", n))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text","text2")) %>%
highlight(off = "plotly_relayout")
ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to) , text2 =paste("number of days:", number_of_days))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text","text2")) %>%
highlight(off = "plotly_relayout")
ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to) , text2 =paste("number of days:", number_of_days))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to) , text2 =paste("number of days:", number_of_days))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text","text2")) %>%
highlight(off = "plotly_relayout")
ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to) , text2=paste("number of days:", number_of_days))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text","text2")) %>%
highlight(off = "plotly_relayout")
paste("number of days:", number_of_days)
ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text1 =paste("from:", from, "to:",to) , text2=paste("number of days:", number_of_days))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text1","text2")) %>%
highlight(off = "plotly_relayout")
ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to) , text=paste("number of days:", number_of_days))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text","text")) %>%
highlight(off = "plotly_relayout")
-ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:\n", from, "to:",to) , text1=paste("number of days:", number_of_days))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text","text1")) %>%
highlight(off = "plotly_relayout")
ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to) , text1=paste("number of days:", number_of_days))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text","text1")) %>%
highlight(off = "plotly_relayout")
ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:<\br>", from, "to:",to) , text1=paste("number of days:", number_of_days))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text","text1")) %>%
highlight(off = "plotly_relayout")
-ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to) , text1=paste("number of days:", number_of_days))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text","text1")) %>%
highlight(off = "plotly_relayout")
ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to) , text1=paste("number of days:", number_of_days))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text","text1")) %>%
highlight(off = "plotly_relayout")
ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to) , text1=paste("number of days:", number_of_days))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to))) +
geom_bar(stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to))) +
geom_bar(width = 0.4 , stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
weekly_hk <- highlight_key(summary_AllDF, ~week)
chart1 <- ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to))) +
geom_bar(width = 0.4 , stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
chart2 <-ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Deaths. , text =paste("from:", from, "to:",to))) +
geom_bar(width = 0.4 , stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
chart3 <-ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Recovered. , text =paste("from:", from, "to:",to))) +
geom_bar(width = 0.4 , stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
DT::datatable(weekly_hk,class = 'cell-border stripe hover compact', rownames = FALSE , options = list(pageLength = 10,order = list(2, 'desc')))%>%
highlight(on = "plotly_click" , off ="plotly_doubleclick")
DT::datatable(weekly_hk,class = 'cell-border stripe hover compact', rownames = FALSE , options = list(pageLength = 10,order = list(0, 'desc')))%>%
highlight(on = "plotly_click" , off ="plotly_doubleclick")
DT::datatable(weekly_hk,class)%>%
highlight(on = "plotly_click" , off ="plotly_doubleclick")
DT::datatable(weekly_hk,class)
DT::datatable(weekly_hk)%>%
highlight(on = "plotly_click" , off ="plotly_doubleclick")
table2 <- DT::datatable(weekly_hk)%>%
highlight(on = "plotly_click" , off ="plotly_doubleclick")
table2 <- DT::datatable(weekly_hk)%>%
highlight(on = "plotly_click" , off ="plotly_doubleclick")
table2
View(summary_AllDF)
summary_AllDF$number_of_days
datatable(summary_AllDF)
as.character(summary_AllDF$number_of_days)
summary_AllDF$number_of_days <- as.character(summary_AllDF$number_of_days)
DT::datatable(summary_AllDF)%>%
highlight(on = "plotly_click" , off ="plotly_doubleclick")
summary_AllDF$number_of_days <- as.integer(summary_AllDF$number_of_days)
DT::datatable(summary_AllDF)%>%
highlight(on = "plotly_click" , off ="plotly_doubleclick")
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls(all=TRUE))
options(stringsAsFactors = FALSE)
library(ggplot2)
library(plotly)
library(flexdashboard)
library(DT)
library(plotly)
library(knitr)
library(lubridate)
library(crosstalk)
setwd("D:/work/git corona/")
df <- read.csv("eg_covid.csv")
df$Day <- mdy(df$Day)
df$AccDay <- df$Day
df$Day <- paste(day(df$Day) , months.Date(df$Day) )
df$Curfew <- as.character(df$Curfew)
########################################################################
#weekly summary
AllDF <- df
shift <- 4
summary_AllDF <- data.frame(AllDF %>% mutate(week = ((as.numeric(AccDay)+shift) %/% 7) - ((as.numeric(min(AccDay))+shift) %/% 7)) %>%
group_by(week) %>%
summarise(number_of_days= table(week), from = min(AccDay) , to = max(AccDay), sum(New.Cases) , sum(New.Deaths), sum(New.Recovered)))
summary_AllDF$number_of_days <- as.integer(summary_AllDF$number_of_days)
########################################################################
df <- df[,1:8]
total_cases <- df$Total.Cases[nrow(df)]
total_deaths <- df$Total.Deaths[nrow(df)]
total_recovered <- df$Total.Recovered[nrow(df)]
closed <- total_deaths+total_recovered
active <- total_cases - closed
df$Day <- factor(df$Day, levels = df$Day)
xlabel <- df$Day[as.integer(seq(1 , nrow(df) , length.out = 10))]
hk <- highlight_key(df, ~Total.Cases)
chart1 <-ggplotly(ggplot(hk, aes(x=Day, y=New.Cases, fill=Curfew)) + scale_x_discrete(breaks = xlabel)+
geom_bar(width = 0.3, stat = "identity")+scale_fill_manual(values = c("#6698FF", "#153E7E"))+
theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1)),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart2 <-ggplotly(ggplot(hk, aes(x=Day, y=New.Deaths, fill=Curfew)) + scale_x_discrete(breaks = xlabel)+
geom_bar(width = 0.3, stat = "identity")+scale_fill_manual(values = c("#6698FF", "#153E7E"))+
theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1)),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart3 <-ggplotly(ggplot(hk, aes(x=Day, y=New.Recovered, fill=Curfew)) + scale_x_discrete(breaks = xlabel)+
geom_bar(width = 0.3, stat = "identity")+scale_fill_manual(values = c("#6698FF", "#153E7E"))+
theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1)),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart4 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Cases, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#33CCFF", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#33CCFF"),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart5 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Deaths, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#FF9900", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#FF9900"),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart6 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Recovered, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#00DDDD", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#00DDDD"),tooltip = c("x", "y"))%>%
highlight(off = "plotly_relayout")
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls(all=TRUE))
options(stringsAsFactors = FALSE)
library(ggplot2)
library(plotly)
library(flexdashboard)
library(DT)
library(plotly)
library(knitr)
library(lubridate)
library(crosstalk)
setwd("D:/work/git corona/")
df <- read.csv("eg_covid.csv")
df$Day <- mdy(df$Day)
df$AccDay <- df$Day
df$Day <- paste(day(df$Day) , months.Date(df$Day) )
df$Curfew <- as.character(df$Curfew)
########################################################################
#weekly summary
AllDF <- df
shift <- 4
summary_AllDF <- data.frame(AllDF %>% mutate(week = ((as.numeric(AccDay)+shift) %/% 7) - ((as.numeric(min(AccDay))+shift) %/% 7)) %>%
group_by(week) %>%
summarise(number_of_days= table(week), from = min(AccDay) , to = max(AccDay), sum(New.Cases) , sum(New.Deaths), sum(New.Recovered)))
summary_AllDF$number_of_days <- as.integer(summary_AllDF$number_of_days)
########################################################################
df <- df[,1:8]
total_cases <- df$Total.Cases[nrow(df)]
total_deaths <- df$Total.Deaths[nrow(df)]
total_recovered <- df$Total.Recovered[nrow(df)]
closed <- total_deaths+total_recovered
active <- total_cases - closed
df$Day <- factor(df$Day, levels = df$Day)
xlabel <- df$Day[as.integer(seq(1 , nrow(df) , length.out = 10))]
hk <- highlight_key(df, ~Total.Cases)
chart1 <-ggplotly(ggplot(hk, aes(x=Day, y=New.Cases, fill=Curfew)) + scale_x_discrete(breaks = xlabel)+
geom_bar(width = 0.3, stat = "identity")+scale_fill_manual(values = c("#6698FF", "#153E7E"))+
theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1)),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart2 <-ggplotly(ggplot(hk, aes(x=Day, y=New.Deaths, fill=Curfew)) + scale_x_discrete(breaks = xlabel)+
geom_bar(width = 0.3, stat = "identity")+scale_fill_manual(values = c("#6698FF", "#153E7E"))+
theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1)),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart3 <-ggplotly(ggplot(hk, aes(x=Day, y=New.Recovered, fill=Curfew)) + scale_x_discrete(breaks = xlabel)+
geom_bar(width = 0.3, stat = "identity")+scale_fill_manual(values = c("#6698FF", "#153E7E"))+
theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1)),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart4 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Cases, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#33CCFF", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#33CCFF"),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart5 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Deaths, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#FF9900", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#FF9900"),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart6 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Recovered, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#00DDDD", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#00DDDD"),tooltip = c("x", "y"))%>%
highlight(off = "plotly_relayout")
valueBox(total_cases)
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls(all=TRUE))
options(stringsAsFactors = FALSE)
library(ggplot2)
library(plotly)
library(flexdashboard)
library(DT)
library(plotly)
library(knitr)
library(lubridate)
library(crosstalk)
setwd("D:/work/git corona/")
df <- read.csv("eg_covid.csv")
df$Day <- mdy(df$Day)
df$AccDay <- df$Day
df$Day <- paste(day(df$Day) , months.Date(df$Day) )
df$Curfew <- as.character(df$Curfew)
########################################################################
#weekly summary
AllDF <- df
shift <- 4
summary_AllDF <- data.frame(AllDF %>% mutate(week = ((as.numeric(AccDay)+shift) %/% 7) - ((as.numeric(min(AccDay))+shift) %/% 7)) %>%
group_by(week) %>%
summarise(number_of_days= table(week), from = min(AccDay) , to = max(AccDay), sum(New.Cases) , sum(New.Deaths), sum(New.Recovered)))
summary_AllDF$number_of_days <- as.integer(summary_AllDF$number_of_days)
########################################################################
df <- df[,1:8]
total_cases <- df$Total.Cases[nrow(df)]
total_deaths <- df$Total.Deaths[nrow(df)]
total_recovered <- df$Total.Recovered[nrow(df)]
closed <- total_deaths+total_recovered
active <- total_cases - closed
df$Day <- factor(df$Day, levels = df$Day)
xlabel <- df$Day[as.integer(seq(1 , nrow(df) , length.out = 10))]
hk <- highlight_key(df, ~Total.Cases)
chart1 <-ggplotly(ggplot(hk, aes(x=Day, y=New.Cases, fill=Curfew)) + scale_x_discrete(breaks = xlabel)+
geom_bar(width = 0.3, stat = "identity")+scale_fill_manual(values = c("#6698FF", "#153E7E"))+
theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1)),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart2 <-ggplotly(ggplot(hk, aes(x=Day, y=New.Deaths, fill=Curfew)) + scale_x_discrete(breaks = xlabel)+
geom_bar(width = 0.3, stat = "identity")+scale_fill_manual(values = c("#6698FF", "#153E7E"))+
theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1)),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart3 <-ggplotly(ggplot(hk, aes(x=Day, y=New.Recovered, fill=Curfew)) + scale_x_discrete(breaks = xlabel)+
geom_bar(width = 0.3, stat = "identity")+scale_fill_manual(values = c("#6698FF", "#153E7E"))+
theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1)),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart4 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Cases, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#33CCFF", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#33CCFF"),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart5 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Deaths, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#FF9900", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#FF9900"),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart6 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Recovered, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#00DDDD", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#00DDDD"),tooltip = c("x", "y"))%>%
highlight(off = "plotly_relayout")
valueBox(total_cases)
valueBox(total_cases)
DT::datatable(hk,class = 'cell-border stripe hover compact', rownames = FALSE , options = list(pageLength = 10,order = list(2, 'desc')))%>%
formatStyle('New.Cases', backgroundColor =  '#FFEEAA') %>%
formatStyle('New.Deaths',backgroundColor =  'red')%>%
formatStyle(names(df),fontWeight = 'bold')%>%
formatStyle('Curfew',  backgroundColor = styleEqual(c(0, 1), c('#a6cee3', '#1f78b4')))%>%
highlight(on = "plotly_click" , off ="plotly_doubleclick")
weekly_hk <- highlight_key(summary_AllDF, ~week)
chart7 <- ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to))) +
geom_bar(width = 0.4 , stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
chart8 <-ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Deaths. , text =paste("from:", from, "to:",to))) +
geom_bar(width = 0.4 , stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
chart9 <-ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Recovered. , text =paste("from:", from, "to:",to))) +
geom_bar(width = 0.4 , stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
DT::datatable(summary_AllDF)%>%
highlight(on = "plotly_click" , off ="plotly_doubleclick")
chart7
chart8
chart9
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls(all=TRUE))
options(stringsAsFactors = FALSE)
library(ggplot2)
library(plotly)
library(flexdashboard)
library(DT)
library(plotly)
library(knitr)
library(lubridate)
library(crosstalk)
setwd("D:/work/git corona/")
df <- read.csv("eg_covid.csv")
df$Day <- mdy(df$Day)
df$AccDay <- df$Day
df$Day <- paste(day(df$Day) , months.Date(df$Day) )
df$Curfew <- as.character(df$Curfew)
########################################################################
#weekly summary
AllDF <- df
shift <- 4
summary_AllDF <- data.frame(AllDF %>% mutate(week = ((as.numeric(AccDay)+shift) %/% 7) - ((as.numeric(min(AccDay))+shift) %/% 7)) %>%
group_by(week) %>%
summarise(number_of_days= table(week), from = min(AccDay) , to = max(AccDay), sum(New.Cases) , sum(New.Deaths), sum(New.Recovered)))
summary_AllDF$number_of_days <- as.integer(summary_AllDF$number_of_days)
########################################################################
df <- df[,1:8]
total_cases <- df$Total.Cases[nrow(df)]
total_deaths <- df$Total.Deaths[nrow(df)]
total_recovered <- df$Total.Recovered[nrow(df)]
closed <- total_deaths+total_recovered
active <- total_cases - closed
df$Day <- factor(df$Day, levels = df$Day)
xlabel <- df$Day[as.integer(seq(1 , nrow(df) , length.out = 10))]
hk <- highlight_key(df, ~Total.Cases)
chart1 <-ggplotly(ggplot(hk, aes(x=Day, y=New.Cases, fill=Curfew)) + scale_x_discrete(breaks = xlabel)+
geom_bar(width = 0.3, stat = "identity")+scale_fill_manual(values = c("#6698FF", "#153E7E"))+
theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1)),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart2 <-ggplotly(ggplot(hk, aes(x=Day, y=New.Deaths, fill=Curfew)) + scale_x_discrete(breaks = xlabel)+
geom_bar(width = 0.3, stat = "identity")+scale_fill_manual(values = c("#6698FF", "#153E7E"))+
theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1)),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart3 <-ggplotly(ggplot(hk, aes(x=Day, y=New.Recovered, fill=Curfew)) + scale_x_discrete(breaks = xlabel)+
geom_bar(width = 0.3, stat = "identity")+scale_fill_manual(values = c("#6698FF", "#153E7E"))+
theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1)),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart4 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Cases, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#33CCFF", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#33CCFF"),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart5 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Deaths, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#FF9900", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#FF9900"),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart6 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Recovered, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#00DDDD", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#00DDDD"),tooltip = c("x", "y"))%>%
highlight(off = "plotly_relayout")
valueBox(total_cases)
valueBox(total_deaths, color="warning")
valueBox(total_recovered , color = "#00DDDD")
valueBox(paste("Closed Cases: ",closed))
valueBox(paste("Active Cases: ",active))
chart1
chart2
chart3
chart4
chart5
chart6
DT::datatable(hk,class = 'cell-border stripe hover compact', rownames = FALSE , options = list(pageLength = 10,order = list(2, 'desc')))%>%
formatStyle('New.Cases', backgroundColor =  '#FFEEAA') %>%
formatStyle('New.Deaths',backgroundColor =  'red')%>%
formatStyle(names(df),fontWeight = 'bold')%>%
formatStyle('Curfew',  backgroundColor = styleEqual(c(0, 1), c('#a6cee3', '#1f78b4')))%>%
highlight(on = "plotly_click" , off ="plotly_doubleclick")
weekly_hk <- highlight_key(summary_AllDF, ~week)
chart7 <- ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to))) +
geom_bar(width = 0.4 , stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
chart8 <-ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Deaths. , text =paste("from:", from, "to:",to))) +
geom_bar(width = 0.4 , stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
chart9 <-ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Recovered. , text =paste("from:", from, "to:",to))) +
geom_bar(width = 0.4 , stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
DT::datatable(summary_AllDF)%>%
highlight(on = "plotly_click" , off ="plotly_doubleclick")
chart7
chart8
chart9
DT::datatable(summary_AllDF)%>%
highlight(on = "plotly_click" , off ="plotly_doubleclick")
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls(all=TRUE))
options(stringsAsFactors = FALSE)
library(ggplot2)
library(plotly)
library(flexdashboard)
library(DT)
library(plotly)
library(knitr)
library(lubridate)
library(crosstalk)
setwd("D:/work/git corona/")
df <- read.csv("eg_covid.csv")
df$Day <- mdy(df$Day)
df$AccDay <- df$Day
df$Day <- paste(day(df$Day) , months.Date(df$Day) )
df$Curfew <- as.character(df$Curfew)
########################################################################
#weekly summary
AllDF <- df
shift <- 4
summary_AllDF <- data.frame(AllDF %>% mutate(week = ((as.numeric(AccDay)+shift) %/% 7) - ((as.numeric(min(AccDay))+shift) %/% 7)) %>%
group_by(week) %>%
summarise(number_of_days= table(week), from = min(AccDay) , to = max(AccDay), sum(New.Cases) , sum(New.Deaths), sum(New.Recovered)))
summary_AllDF$number_of_days <- as.integer(summary_AllDF$number_of_days)
########################################################################
df <- df[,1:8]
total_cases <- df$Total.Cases[nrow(df)]
total_deaths <- df$Total.Deaths[nrow(df)]
total_recovered <- df$Total.Recovered[nrow(df)]
closed <- total_deaths+total_recovered
active <- total_cases - closed
df$Day <- factor(df$Day, levels = df$Day)
xlabel <- df$Day[as.integer(seq(1 , nrow(df) , length.out = 10))]
hk <- highlight_key(df, ~Total.Cases)
chart1 <-ggplotly(ggplot(hk, aes(x=Day, y=New.Cases, fill=Curfew)) + scale_x_discrete(breaks = xlabel)+
geom_bar(width = 0.3, stat = "identity")+scale_fill_manual(values = c("#6698FF", "#153E7E"))+
theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1)),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart2 <-ggplotly(ggplot(hk, aes(x=Day, y=New.Deaths, fill=Curfew)) + scale_x_discrete(breaks = xlabel)+
geom_bar(width = 0.3, stat = "identity")+scale_fill_manual(values = c("#6698FF", "#153E7E"))+
theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1)),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart3 <-ggplotly(ggplot(hk, aes(x=Day, y=New.Recovered, fill=Curfew)) + scale_x_discrete(breaks = xlabel)+
geom_bar(width = 0.3, stat = "identity")+scale_fill_manual(values = c("#6698FF", "#153E7E"))+
theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1)),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart4 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Cases, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#33CCFF", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#33CCFF"),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart5 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Deaths, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#FF9900", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#FF9900"),tooltip = c("x", "y")) %>%
highlight(off = "plotly_relayout")
chart6 <- ggplotly(ggplot(data=hk, aes(x=Day, y=Total.Recovered, group=1))+ scale_x_discrete(breaks = xlabel)+
geom_line(color="#00DDDD", size=1)+theme(panel.grid.major.x  = element_blank(), axis.text.x = element_text(angle = 70, hjust = 1))+
geom_point(color="#00DDDD"),tooltip = c("x", "y"))%>%
highlight(off = "plotly_relayout")
DT::datatable(weekly_hk)%>%
highlight(on = "plotly_click" , off ="plotly_doubleclick")
weekly_hk <- highlight_key(summary_AllDF, ~week)
chart7 <- ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Cases. , text =paste("from:", from, "to:",to))) +
geom_bar(width = 0.4 , stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
chart8 <-ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Deaths. , text =paste("from:", from, "to:",to))) +
geom_bar(width = 0.4 , stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
chart9 <-ggplotly(ggplot(weekly_hk, aes(x=week , y=sum.New.Recovered. , text =paste("from:", from, "to:",to))) +
geom_bar(width = 0.4 , stat = "identity")+scale_fill_manual(values = c("#153E7E"))+
theme(panel.grid.major.x  = element_blank()),tooltip = c("x", "y" , "text")) %>%
highlight(off = "plotly_relayout")
DT::datatable(weekly_hk)%>%
highlight(on = "plotly_click" , off ="plotly_doubleclick")
